<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RusPump Engineering Cockpit</title>
    <!-- Modern Fonts (Using System Fallbacks for Offline Readiness) -->

</head>
<style>
    /* Critical CSS to prevent FOUC (Flash of Unstyled Content) */
    .app-shell {
        opacity: 0;
        transition: opacity 0.3s ease-out;
    }

    body.loaded .app-shell {
        opacity: 1;
    }
</style>

<body>

    <div class="app-shell">
        <!-- HEADER -->
        <header class="app-header">
            <div class="brand" style="font-weight:700; letter-spacing:1px;">RUSPUMP <span
                    style="font-weight:400; opacity:0.7; font-size: 0.8em">ENG_SUITE</span></div>
            <nav class="nav-tabs">
                <div class="tab-btn active" onclick="showTab('calc')">–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –ø–æ —Ç–æ—á–∫–∞–º</div>
                <div class="tab-btn" onclick="showTab('modes')">–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –ø–æ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞–º</div>
                <div class="tab-btn" onclick="showTab('archive')">–ê—Ä—Ö–∏–≤ –ë–î</div>
                <div id="adminTabBtn" class="tab-btn" onclick="showTab('admin')" style="display:none">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</div>
                <div class="tab-btn" onclick="showTab('selection')">–ü–æ–¥–±–æ—Ä</div>
                <div class="tab-btn" onclick="showTab('digitizer')">–û—Ü–∏—Ñ—Ä–æ–≤—â–∏–∫</div>
            </nav>
            <div class="workspace-selector">
                <select id="modeSelector" class="workspace-select" onchange="switchMode(this.value)">
                    <option value="local">üìÅ –õ–∏—á–Ω—ã–π (JSON)</option>
                    <option value="cloud">üë• –ö–æ–º–∞–Ω–¥–Ω—ã–π (SQL)</option>
                </select>
            </div>
            <div id="authSection" class="auth-section">
                <span id="userInfo" class="user-info"></span>
                <button id="authBtn" class="btn btn-outline btn-sm" onclick="toggleAuth()">–í—Ö–æ–¥</button>
            </div>
            <div style="font-size:11px; color:#aaa;" id="buildVersion">v2.65 (Hybrid)</div>
        </header>

        <!-- MAIN WORKSPACE GRID (Unified Sidebar) -->
        <div id="main-workspace" class="workspace-grid active">

            <!-- STAGE CONTAINER (Charts Area) -->
            <div class="stage-container">

                <!-- STAGE: CALC -->
                <div id="stage-calc" class="stage-view active">
                    <section class="stage">
                        <div class="chart-card chart-top">
                            <div id="chartCombo1" class="chart-instance"></div>
                        </div>
                        <div class="chart-card chart-bottom">
                            <div id="chartCombo2" class="chart-instance"></div>
                        </div>
                        <div id="mathFooter" class="math-panel">
                            <div id="mathHeader" class="math-header">
                                <span>–†–ê–ë–û–ß–ê–Ø –¢–û–ß–ö–ê (–§–ê–ö–¢)</span>
                                <span>Q = <span id="factQ" class="val">-</span> | H = <span id="factH"
                                        class="val">-</span></span>
                            </div>
                            <div id="mathContent"></div>
                            <div class="coeff-grid" id="coeffGrid"></div>
                        </div>
                    </section>
                </div>

                <!-- STAGE: MODES -->
                <div id="stage-modes" class="stage-view">
                    <section class="stage">
                        <div class="chart-card chart-top">
                            <div id="modes-chartCombo1" class="chart-instance"></div>
                        </div>
                        <div class="chart-card chart-bottom">
                            <div id="modes-chartCombo2" class="chart-instance"></div>
                        </div>
                        <div id="modes-mathFooter" class="math-panel" style="display:none;">
                            <div id="modes-mathHeader" class="math-header"></div>
                            <div id="modes-mathContent"></div>
                            <div class="coeff-grid" id="modes-coeffGrid"></div>
                        </div>
                    </section>
                </div>

                <!-- End Stage Container -->
            </div>

            <!-- ASIDE: CONTROLS (Right Column) -->
            <aside class="controls">
                <div class="controls-header">
                    <h2 class="controls-title" id="controls-title">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã</h2>
                    <!-- Unified Logo Box -->
                    <div class="logo-wrapper">
                        <img id="logoImg" class="logo-btn"
                            src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTUwIiBoZWlnaHQ9IjUwIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9IiNmOGY5ZmEiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjE0IiBmaWxsPSIjMDA0MDg1IiBkeT0iLjVlbSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+TE9HTzwvdGV4dD48L3N2Zz4="
                            onclick="document.getElementById('logoUpload').click()" title="–ó–∞–≥—Ä—É–∑–∏—Ç—å –ª–æ–≥–æ">
                        <input type="file" id="logoUpload" accept="image/*" style="display:none"
                            onchange="loadLogo(this, 'logoImg')">
                    </div>
                </div>

                <div class="controls-body">

                    <!-- CONTROLS: CALC -->
                    <div id="controls-calc" class="controls-content active">
                        <!-- GROUP 1: META + ID -->
                        <fieldset class="control-group">
                            <legend>–ü—Ä–æ–µ–∫—Ç</legend>
                            <div class="form-grid">
                                <div class="form-row"><label class="form-label">ID –†–∞—Å—á–µ—Ç–∞</label><input type="text"
                                        id="dispId" value="NEW" class="form-input" readonly></div>
                                <div class="form-row"><label class="form-label">–ö–æ–º–ø–∞–Ω–∏—è</label><input type="text"
                                        id="company" value="RusPump" class="form-input"></div>
                                <div class="form-row"><label class="form-label">–ò–Ω–∂–µ–Ω–µ—Ä</label><input type="text"
                                        id="executor" value="–î–º–∏—Ç—Ä–∏–π" class="form-input"></div>
                                <div class="form-row"><label class="form-label">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label><textarea
                                        id="comment" class="form-input"
                                        style="height: 60px; resize: vertical;"></textarea></div>
                            </div>
                        </fieldset>

                        <!-- GROUP 2: PUMP SPECS -->
                        <fieldset class="control-group">
                            <legend>–ü–∞—Å–ø–æ—Ä—Ç –ù–∞—Å–æ—Å–∞</legend>
                            <div class="form-grid">
                                <div class="form-row"><label class="form-label">–ú–æ–¥–µ–ª—å (Orig)</label><input type="text"
                                        id="pumpName" placeholder="..." class="form-input"
                                        oninput="syncOEM(this.value)">
                                </div>
                                <div class="form-row"><label class="form-label">–ú–æ–¥–µ–ª—å (OEM)</label><input type="text"
                                        id="oemName" class="form-input"></div>
                                <div class="form-row" style="grid-template-columns: 1fr 1fr; gap:10px; display:grid;">
                                    <div><label class="form-label">In (mm)</label><input type="number" id="dn_suction"
                                            value="100" class="form-input"></div>
                                    <div><label class="form-label">Out (mm)</label><input type="number"
                                            id="dn_discharge" value="80" class="form-input"></div>
                                </div>
                                <div class="form-row"><label class="form-label">RPM (–æ–±/–º–∏–Ω)</label><input type="number"
                                        id="rpm" value="2950" class="form-input"></div>
                                <div class="form-row"><label class="form-label">–ö–æ–ª–µ—Å–æ (–º–º)</label><input type="number"
                                        id="impeller" value="250" class="form-input"></div>
                                <div class="form-row"><label class="form-label">Motor P2</label>
                                    <div style="display:grid; grid-template-columns: 2fr 1fr; gap:5px;">
                                        <input type="text" id="p2_nom" value="45" class="form-input">
                                        <select id="p2_unit" class="form-select">
                                            <option value="kW">kW</option>
                                            <option value="hp">hp</option>
                                            <option value="W">W</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-row"><label class="form-label">–ß–µ—Ä—Ç–µ–∂</label>
                                    <div class="input-file-wrapper">
                                        <input type="file" id="drawingFile">
                                        <a id="drawLink" href="#" target="_blank" class="link-action"
                                            style="display:none;">[View]</a>
                                    </div>
                                </div>
                            </div>
                        </fieldset>

                        <!-- GROUP 3: COMMERCIAL -->
                        <fieldset class="control-group">
                            <legend>–ö–æ–º–º–µ—Ä—Ü–∏—è</legend>
                            <div class="form-grid">
                                <div class="form-row"><label class="form-label">–¶–µ–Ω–∞ / –í–∞–ª—é—Ç–∞</label>
                                    <div
                                        style="display:grid; grid-template-columns: 2fr 1fr; gap:5px; align-items: center;">
                                        <input type="text" id="price" class="form-input" placeholder="0.00">
                                        <select id="currency" class="form-select">
                                            <option value="">-</option>
                                            <option value="RUB">RUB</option>
                                            <option value="CNY">CNY</option>
                                            <option value="USD">USD</option>
                                            <option value="EUR">EUR</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </fieldset>

                        <!-- GROUP 4: OPERATING POINT -->
                        <fieldset class="control-group" style="border-left: 3px solid var(--brand-warning);">
                            <legend style="color:var(--brand-warning);">–†–∞–±–æ—á–∞—è –¢–æ—á–∫–∞ (–ó–∞–¥–∞–Ω–∏–µ)</legend>
                            <div class="form-grid">
                                <div class="form-row"><label class="form-label">Q req</label>
                                    <div style="display:grid; grid-template-columns: 2fr 1.5fr; gap:5px;">
                                        <input type="text" id="qReq" value="35" class="form-input"
                                            style="font-weight:bold;">
                                        <select id="q_unit" class="form-select">
                                            <option value="m3h">m¬≥/h</option>
                                            <option value="ls">l/s</option>
                                            <option value="lmin">l/min</option>
                                            <option value="usgpm">US gpm</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-row"><label class="form-label">H req</label>
                                    <div style="display:grid; grid-template-columns: 2fr 1fr; gap:5px;">
                                        <input type="text" id="hReq" value="45" class="form-input"
                                            style="font-weight:bold;">
                                        <select id="h_unit" class="form-select">
                                            <option value="m">m</option>
                                            <option value="ft">ft</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-row"><label class="form-label">H st (–°—Ç–∞—Ç–∏–∫–∞)</label><input type="text"
                                        id="hSt" value="0" class="form-input"></div>
                            </div>
                        </fieldset>

                        <!-- GROUP 5: CURVE DATA -->
                        <fieldset class="control-group" style="border-left: 3px solid var(--brand-primary);">
                            <legend style="color:var(--brand-primary);">–¢–æ—á–∫–∏ –ö—Ä–∏–≤–æ–π (CSV/Space)</legend>
                            <div class="curve-grid">
                                <div class="curve-row" style="grid-template-columns: 60px 1fr 140px;">
                                    <label class="form-label">Q</label><input type="text" id="qText"
                                        value="0 10 20 30 40 50" class="form-input">
                                    <select id="q_curve_unit" class="form-select"
                                        style="font-family: var(--font-mono);">
                                        <option value="m3h">m¬≥/h</option>
                                        <option value="ls">l/s</option>
                                        <option value="lmin">l/min</option>
                                        <option value="usgpm">US gpm</option>
                                    </select>
                                </div>
                                <div class="curve-row" style="grid-template-columns: 60px 1fr 140px;">
                                    <label class="form-label">H</label><input type="text" id="hText"
                                        value="60 58 52 40 22 5" class="form-input">
                                    <select id="h_curve_unit" class="form-select"
                                        style="font-family: var(--font-mono);">
                                        <option value="m">m</option>
                                        <option value="ft">ft</option>
                                    </select>
                                </div>
                                <div class="curve-row" style="grid-template-columns: 60px 1fr 140px;">
                                    <label class="form-label">NPSH</label><input type="text" id="npshText"
                                        value="2 2.2 2.5 3.1 4.2 6" class="form-input">
                                    <select id="npsh_curve_unit" class="form-select"
                                        style="font-family: var(--font-mono);">
                                        <option value="m">m</option>
                                        <option value="ft">ft</option>
                                    </select>
                                </div>
                                <div class="curve-row" style="grid-template-columns: 60px 1fr 140px;">
                                    <label class="form-label">P2</label><input type="text" id="p2Text"
                                        value="15 18 22 28 35 42" class="form-input">
                                    <select id="p2_curve_unit" class="form-select"
                                        style="font-family: var(--font-mono);">
                                        <option value="kW">kW</option>
                                        <option value="hp">hp</option>
                                        <option value="W">W</option>
                                    </select>
                                </div>
                                <div class="curve-row"><label class="form-label">–ö–ü–î (%)</label><input type="text"
                                        id="effText" value="0 45 68 78 72 50" class="form-input"></div>
                                <div style="text-align:right; margin-top:5px;">
                                    <label
                                        style="font-size:18px; cursor:pointer; color:var(--brand-primary); border-bottom:1px dashed;">
                                        –ò–º–ø–æ—Ä—Ç CSV <input type="file" accept=".csv" onchange="importCSV(this)"
                                            style="display:none;">
                                    </label>
                                </div>
                            </div>
                        </fieldset>
                    </div>

                    <!-- CONTROLS: MODES -->
                    <div id="controls-modes" class="controls-content">
                        <fieldset class="control-group">
                            <legend>–ü—Ä–æ–µ–∫—Ç</legend>
                            <div class="form-grid">
                                <div class="form-row"><label class="form-label">ID –†–∞—Å—á–µ—Ç–∞</label><input type="text"
                                        id="modes-dispId" value="NEW" class="form-input" readonly></div>
                                <div class="form-row"><label class="form-label">–ö–æ–º–ø–∞–Ω–∏—è</label><input type="text"
                                        id="modes-company" value="RusPump" class="form-input"></div>
                                <div class="form-row"><label class="form-label">–ò–Ω–∂–µ–Ω–µ—Ä</label><input type="text"
                                        id="modes-executor" value="–î–º–∏—Ç—Ä–∏–π" class="form-input"></div>
                                <div class="form-row"><label class="form-label">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label><textarea
                                        id="modes-comment" class="form-input"
                                        style="height: 60px; resize: vertical;"></textarea></div>
                            </div>
                        </fieldset>

                        <fieldset class="control-group">
                            <legend>–ü–∞—Å–ø–æ—Ä—Ç –ù–∞—Å–æ—Å–∞</legend>
                            <div class="form-grid">
                                <div class="form-row"><label class="form-label">–ú–æ–¥–µ–ª—å (Orig)</label><input type="text"
                                        id="modes-pumpName" placeholder="..." class="form-input"
                                        oninput="syncOEM(this.value, 'modes-')"></div>
                                <div class="form-row"><label class="form-label">–ú–æ–¥–µ–ª—å (OEM)</label><input type="text"
                                        id="modes-oemName" class="form-input"></div>
                                <div class="form-row" style="grid-template-columns: 1fr 1fr; gap:10px; display:grid;">
                                    <div><label class="form-label">In (mm)</label><input type="number"
                                            id="modes-dn_suction" value="100" class="form-input"></div>
                                    <div><label class="form-label">Out (mm)</label><input type="number"
                                            id="modes-dn_discharge" value="80" class="form-input"></div>
                                </div>
                                <div class="form-row"><label class="form-label">RPM (–æ–±/–º–∏–Ω)</label><input type="number"
                                        id="modes-rpm" value="2950" class="form-input"></div>
                                <div class="form-row"><label class="form-label">–ö–æ–ª–µ—Å–æ (–º–º)</label><input type="number"
                                        id="modes-impeller" value="250" class="form-input"></div>
                                <div class="form-row"><label class="form-label">Motor P2</label>
                                    <div style="display:grid; grid-template-columns: 2fr 1fr; gap:5px;">
                                        <input type="text" id="modes-p2_nom" value="45" class="form-input">
                                        <select id="modes-p2_unit" class="form-select">
                                            <option value="kW">kW</option>
                                            <option value="hp">hp</option>
                                            <option value="W">W</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-row"><label class="form-label">–ß–µ—Ä—Ç–µ–∂</label>
                                    <div class="input-file-wrapper">
                                        <input type="file" id="modes-drawingFile">
                                        <a id="modes-drawLink" href="#" target="_blank" class="link-action"
                                            style="display:none;">[View]</a>
                                    </div>
                                </div>
                            </div>
                        </fieldset>

                        <fieldset class="control-group">
                            <legend>–ö–æ–º–º–µ—Ä—Ü–∏—è</legend>
                            <div class="form-grid">
                                <div class="form-row"><label class="form-label">–¶–µ–Ω–∞ / –í–∞–ª—é—Ç–∞</label>
                                    <div
                                        style="display:grid; grid-template-columns: 2fr 1fr; gap:5px; align-items: center;">
                                        <input type="text" id="modes-price" class="form-input" placeholder="0.00">
                                        <select id="modes-currency" class="form-select">
                                            <option value="">-</option>
                                            <option value="RUB">RUB</option>
                                            <option value="CNY">CNY</option>
                                            <option value="USD">USD</option>
                                            <option value="EUR">EUR</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </fieldset>

                        <fieldset class="control-group" style="border-left: 3px solid var(--brand-warning);">
                            <legend style="color:var(--brand-warning);">–†–∞–±–æ—á–∞—è –¢–æ—á–∫–∞ (–ó–∞–¥–∞–Ω–∏–µ)</legend>
                            <div class="form-grid">
                                <div class="form-row"><label class="form-label">Q req</label>
                                    <div style="display:grid; grid-template-columns: 2fr 1.2fr; gap:5px;">
                                        <input type="text" id="modes-qReq" value="35" class="form-input"
                                            style="font-weight:bold;">
                                        <select id="modes-q_unit" class="form-select">
                                            <option value="m3h">m¬≥/h</option>
                                            <option value="ls">l/s</option>
                                            <option value="lmin">l/min</option>
                                            <option value="usgpm">US gpm</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-row"><label class="form-label">H req</label>
                                    <div style="display:grid; grid-template-columns: 2fr 1fr; gap:5px;">
                                        <input type="text" id="modes-hReq" value="45" class="form-input"
                                            style="font-weight:bold;">
                                        <select id="modes-h_unit" class="form-select">
                                            <option value="m">m</option>
                                            <option value="ft">ft</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-row"><label class="form-label">H st (–°—Ç–∞—Ç–∏–∫–∞)</label><input type="text"
                                        id="modes-hSt" value="0" class="form-input"></div>
                            </div>
                        </fieldset>

                        <!-- COEFFICIENTS GRID -->
                        <fieldset class="control-group" style="border-left: 3px solid var(--brand-primary);">
                            <legend style="color:var(--brand-primary);">–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –ü–æ–ª–∏–Ω–æ–º–æ–≤</legend>
                            <div
                                style="margin-bottom:10px; display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px;">
                                <div><label class="form-label">Q min</label><input type="text" id="modes-qMin" value="0"
                                        class="form-input" oninput="calcModes(false)"></div>
                                <div><label class="form-label">Q max</label><input type="text" id="modes-qMax"
                                        value="100" class="form-input" oninput="calcModes(false)"></div>
                                <div><label class="form-label">–ï–¥. Q</label><select id="modes-q_curve_unit"
                                        class="form-select" onchange="calcModes(false)">
                                        <option value="m3h">m¬≥/h</option>
                                        <option value="ls">l/s</option>
                                        <option value="lmin">l/min</option>
                                        <option value="usgpm">US gpm</option>
                                    </select></div>
                            </div>

                            <div class="coeff-input-grid">
                                <div class="coeff-input-header">–ü–∞—Ä–∞–º–µ—Ç—Ä</div>
                                <div class="coeff-input-header">A0</div>
                                <div class="coeff-input-header">A1</div>
                                <div class="coeff-input-header">A2</div>
                                <div class="coeff-input-header">A3</div>
                                <div class="coeff-input-header">–ï–¥. Y</div>

                                <!-- H-Q -->
                                <div class="coeff-input-label">H (–ù–∞–ø–æ—Ä)</div>
                                <input type="text" id="modes-h-a0" value="60" class="form-input mini"
                                    oninput="calcModes(false)">
                                <input type="text" id="modes-h-a1" value="0" class="form-input mini"
                                    oninput="calcModes(false)">
                                <input type="text" id="modes-h-a2" value="-0.02" class="form-input mini"
                                    oninput="calcModes(false)">
                                <input type="text" id="modes-h-a3" value="0" class="form-input mini"
                                    oninput="calcModes(false)">
                                <select id="modes-h_curve_unit" class="form-select" onchange="calcModes(false)">
                                    <option value="m">m</option>
                                    <option value="ft">ft</option>
                                </select>

                                <!-- EFF -->
                                <div class="coeff-input-label">Eff (%)</div>
                                <input type="text" id="modes-eff-a0" value="0" class="form-input mini"
                                    oninput="calcModes(false)">
                                <input type="text" id="modes-eff-a1" value="3.5" class="form-input mini"
                                    oninput="calcModes(false)">
                                <input type="text" id="modes-eff-a2" value="-0.04" class="form-input mini"
                                    oninput="calcModes(false)">
                                <input type="text" id="modes-eff-a3" value="0" class="form-input mini"
                                    oninput="calcModes(false)">
                                <div class="form-select-disabled">%</div>

                                <!-- P2 -->
                                <div class="coeff-input-label">P2 (–ú–æ—â.)</div>
                                <input type="text" id="modes-p2-a0" value="15" class="form-input mini"
                                    oninput="calcModes(false)">
                                <input type="text" id="modes-p2-a1" value="0.5" class="form-input mini"
                                    oninput="calcModes(false)">
                                <input type="text" id="modes-p2-a2" value="0" class="form-input mini"
                                    oninput="calcModes(false)">
                                <input type="text" id="modes-p2-a3" value="0" class="form-input mini"
                                    oninput="calcModes(false)">
                                <select id="modes-p2_curve_unit" class="form-select" onchange="calcModes(false)">
                                    <option value="kW">kW</option>
                                    <option value="hp">hp</option>
                                    <option value="W">W</option>
                                </select>

                                <!-- NPSH -->
                                <div class="coeff-input-label">NPSH</div>
                                <input type="text" id="modes-npsh-a0" value="2" class="form-input mini"
                                    oninput="calcModes(false)">
                                <input type="text" id="modes-npsh-a1" value="0.05" class="form-input mini"
                                    oninput="calcModes(false)">
                                <input type="text" id="modes-npsh-a2" value="0.001" class="form-input mini"
                                    oninput="calcModes(false)">
                                <input type="text" id="modes-npsh-a3" value="0" class="form-input mini"
                                    oninput="calcModes(false)">
                                <select id="modes-npsh_curve_unit" class="form-select" onchange="calcModes(false)">
                                    <option value="m">m</option>
                                    <option value="ft">ft</option>
                                </select>
                            </div>
                        </fieldset>
                    </div>

                </div>

                <!-- PERSISTENT SUBMIT (Dynamically triggers based on active tab via visual or JS) -->
                <!-- Ideally we move buttons into the specific controls content OR keep here and use JS to route -->
                <!-- For now, duplicating buttons inside each control-content is safer for context, OR we can keep sticky footer. 
                     The original sidebar had sticky footer. Let's keep buttons inside specific control panels to avoid confusion. -->
                <div id="controls-footer-calc" class="controls-submit" style="display:block;">
                    <button class="btn btn-primary" onclick="calc(false)">–†–ê–°–°–ß–ò–¢–ê–¢–¨ –ì–†–ê–§–ò–ö</button>
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:8px;">
                        <button class="btn btn-success" onclick="calc(true)">–°–û–•–†–ê–ù–ò–¢–¨ –í –ë–î</button>
                        <button class="btn btn-secondary" onclick="exportToPNG()">–°–ö–ê–ß–ê–¢–¨ PDF</button>
                    </div>
                </div>

                <div id="controls-footer-modes" class="controls-submit" style="display:none;">
                    <button class="btn btn-primary" onclick="calcModes(false)">–†–ê–°–°–ß–ò–¢–ê–¢–¨ –ì–†–ê–§–ò–ö</button>
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:8px;">
                        <button class="btn btn-success" onclick="calcModes(true)">–°–û–•–†–ê–ù–ò–¢–¨ –í –ë–î</button>
                        <button class="btn btn-secondary" onclick="exportToPNG()">–°–ö–ê–ß–ê–¢–¨ PDF</button>
                    </div>
                </div>

            </aside>
        </div>

        <!-- VIEW: ARCHIVE (TABLE) - Outside Grid -->
        <div id="tab-archive" class="workspace-view">
            <div class="archive-wrapper">
                <div class="archive-toolbar">
                    <h3 style="margin:0; margin-right:auto; align-self:center;">–ê—Ä—Ö–∏–≤ –†–∞—Å—á–µ—Ç–æ–≤</h3>
                    <div id="localFileControls" style="display:flex; gap:10px;">
                        <button class="btn btn-primary btn-sm" onclick="selectLocalFile()">–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª JSON</button>
                        <span id="localFileName"
                            style="font-size:12px; align-self:center; color:var(--brand-primary)"></span>
                    </div>
                    <input type="text" id="globalSearch" placeholder="–ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫..." class="form-input"
                        style="width:200px;" oninput="filterArchive()">
                    <button class="btn btn-outline" style="width:auto;" onclick="exportDB()">–≠–∫—Å–ø–æ—Ä—Ç</button>
                    <button class="btn btn-warning" id="importBtn" style="width:auto; background:#ffc107;"
                        onclick="document.getElementById('dbUpload').click()">–ò–º–ø–æ—Ä—Ç</button>
                    <button class="btn btn-outline" style="width:auto; border-color:#dc3545; color:#dc3545;"
                        onclick="resetFilters()">‚ùå –°–±—Ä–æ—Å</button>
                    <input type="file" id="dbUpload" style="display:none" onchange="importDB(this)">
                </div>
                <!-- Main Archive Table -->
                <div style="overflow-x:auto; height: calc(100vh - 120px);">
                    <table class="archive-table">
                        <thead>
                            <tr>
                                <th width="50">ID</th>
                                <th>–û—Ä–∏–≥–∏–Ω–∞–ª</th>
                                <th>OEM</th>
                                <th>–ö–æ–º–ø–∞–Ω–∏—è</th>
                                <th>–°–æ–∑–¥–∞–Ω–æ</th>
                                <th>–ò–∑–º–µ–Ω–µ–Ω–æ</th>
                                <th>Q req</th>
                                <th>H req</th>
                                <th>Q min</th>
                                <th>Q max</th>
                                <th>H min</th>
                                <th>H max</th>
                                <th>P2</th>
                                <th>DN –≤—Ö</th>
                                <th>DN –≤—ã—Ö</th>
                                <th>–¶–µ–Ω–∞</th>
                                <th>–í–∞–ª—é—Ç–∞</th>
                                <th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
                                <th>–ò–º—è —Ñ–∞–π–ª–∞</th>
                                <th>–ß–µ—Ä—Ç–µ–∂</th>
                                <th></th>
                            </tr>
                            <tr id="filterRow">
                                <th><input type="text" f-key="id" oninput="filterArchive()" class="form-input"
                                        style="font-size: var(--fs-sm);"></th>
                                <th><input type="text" f-key="name" oninput="filterArchive()" class="form-input"
                                        style="font-size: var(--fs-sm);"></th>
                                <th><input type="text" f-key="oem_name" oninput="filterArchive()" class="form-input"
                                        style="font-size: var(--fs-sm);"></th>
                                <th><input type="text" f-key="company" oninput="filterArchive()" class="form-input"
                                        style="font-size: var(--fs-sm);"></th>
                                <th><input type="text" f-key="created_at" oninput="filterArchive()" class="form-input"
                                        style="font-size: var(--fs-sm);"></th>
                                <th><input type="text" f-key="updated_at" oninput="filterArchive()" class="form-input"
                                        style="font-size: var(--fs-sm);"></th>
                                <th><input type="text" f-key="q_req" oninput="filterArchive()" class="form-input"
                                        style="font-size: var(--fs-sm);"></th>
                                <th><input type="text" f-key="h_req" oninput="filterArchive()" class="form-input"
                                        style="font-size: var(--fs-sm);"></th>
                                <th><input type="text" f-key="q_min" oninput="filterArchive()" class="form-input"
                                        style="font-size: var(--fs-sm);"></th>
                                <th><input type="text" f-key="q_max" oninput="filterArchive()" class="form-input"
                                        style="font-size: var(--fs-sm);"></th>
                                <th><input type="text" f-key="h_min" oninput="filterArchive()" class="form-input"
                                        style="font-size: var(--fs-sm);"></th>
                                <th><input type="text" f-key="h_max" oninput="filterArchive()" class="form-input"
                                        style="font-size: var(--fs-sm);"></th>
                                <th><input type="text" f-key="p2_nom" oninput="filterArchive()" class="form-input"
                                        style="font-size: var(--fs-sm);"></th>
                                <th><input type="text" f-key="dn_suction" oninput="filterArchive()" class="form-input"
                                        style="font-size: var(--fs-sm);"></th>
                                <th><input type="text" f-key="dn_discharge" oninput="filterArchive()" class="form-input"
                                        style="font-size: var(--fs-sm);"></th>
                                <th><input type="text" f-key="price" oninput="filterArchive()" class="form-input"
                                        style="font-size: var(--fs-sm);"></th>
                                <th><input type="text" f-key="currency" oninput="filterArchive()" class="form-input"
                                        style="font-size: var(--fs-sm);"></th>
                                <th><input type="text" f-key="comment" oninput="filterArchive()" class="form-input"
                                        style="font-size: var(--fs-sm);"></th>
                                <th><input type="text" f-key="drawing_filename" oninput="filterArchive()"
                                        class="form-input" style="font-size: var(--fs-sm);"></th>
                                <th></th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody id="archiveBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- VIEW: SELECTION -->
        <div id="tab-selection" class="workspace-view" style="display:none; flex-direction:column; padding:20px;">
            <div class="archive-wrapper" style="max-width:1200px; margin:0 auto; width:100%;">
                <div class="archive-toolbar" style="justify-content:space-between;">
                    <div style="display:flex; gap:15px; align-items:center;">
                        <div style="font-weight:bold; font-size:18px; color:var(--brand-primary)">–ü–û–î–ë–û–† –ù–ê–°–û–°–û–í</div>

                        <div class="control-group"
                            style="margin:0; padding:5px 10px; display:flex; gap:10px; align-items:center; background:#fff;">
                            <span style="font-weight:600">Q req:</span>
                            <input id="sel-q" type="number" class="form-input" style="width:80px; height:32px;"
                                placeholder="–º¬≥/—á">

                            <span style="font-weight:600">H req:</span>
                            <input id="sel-h" type="number" class="form-input" style="width:80px; height:32px;"
                                placeholder="–º">

                            <span style="font-weight:600">–î–æ–ø—É—Å–∫ (%):</span>
                            <input id="sel-tol" type="number" class="form-input" style="width:60px; height:32px;"
                                value="10">
                        </div>

                        <button id="btn-search" class="btn btn-primary" style="width:auto;"
                            onclick="SelectionCore.search()">
                            üîç –ù–ê–ô–¢–ò
                        </button>
                        <div id="sel-spinner" class="spinner"
                            style="width:24px; height:24px; border-width:3px; display:none;"></div>
                    </div>
                </div>

                <div style="overflow-x:auto;">
                    <table class="archive-table">
                        <thead>
                            <tr>
                                <th width="50">ID</th>
                                <th>–ú–æ–¥–µ–ª—å</th>
                                <th>–û–±/–º–∏–Ω</th>
                                <th>H (—Ä–∞—Å—á)</th>
                                <th>–û—Ç–∫–ª %</th>
                                <th>Power (–∫–í—Ç)</th>
                                <th>–ö–ü–î (%)</th>
                                <th width="100">–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody id="sel-table-body">
                            <tr>
                                <td colspan="8" style="color:#777; padding:20px;">–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ –Ω–∞–∂–º–∏—Ç–µ –ù–∞–π—Ç–∏</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- VIEW: DIGITIZER -->
        <div id="tab-digitizer" class="workspace-view"
            style="flex-direction: column; height: calc(100vh - var(--header-height)); overflow: hidden;">

            <!-- TOOLBAR -->
            <div class="digitizer-toolbar">
                <div style="display:flex; gap:15px; align-items:center;">
                    <button class="btn btn-secondary" style="width:auto;"
                        onclick="document.getElementById('imgUpload').click()">
                        üìÇ –ó–ê–ì–†–£–ó–ò–¢–¨ (IMG/PDF)
                    </button>
                    <input type="file" id="imgUpload" accept="image/*,application/pdf" style="display:none">

                    <div class="mode-selector">
                        <label class="radio-label"><input type="radio" name="digMode" value="QH" checked> Q-H</label>
                        <label class="radio-label"><input type="radio" name="digMode" value="QP"> Q-P</label>
                        <label class="radio-label"><input type="radio" name="digMode" value="QN"> Q-NPSH</label>
                        <label class="radio-label"><input type="radio" name="digMode" value="QE"> Q-Eff</label>
                    </div>
                </div>

                <div style="display:flex; gap:10px;">
                    <div class="digi-help-text"
                        style="display:flex; align-items:center; gap:10px; margin-right:15px; color:var(--text-secondary);">
                        <span>üñ±Ô∏è Zoom: Wheel</span>
                        <span>‚úã Pan: Drag</span>
                        <span>üéØ Point: Space/Click</span>
                    </div>
                    <button class="btn btn-primary"
                        style="width:auto; background-color: var(--brand-primary); color: white;"
                        onclick="DigiCore.clearPoints()">üîÑ –°–ë–†–û–°–ò–¢–¨ –¢–û–ß–ö–ò</button>
                    <button class="btn btn-primary" style="width:auto;" onclick="DigiCore.exportData()">‚úÖ –ü–ï–†–ï–ù–ï–°–¢–ò –í
                        –†–ê–°–ß–ï–¢</button>
                </div>
            </div>

            <!-- MAIN AREA -->
            <div class="digitizer-container" id="digiContainer">
                <canvas id="digiCanvas"></canvas>

                <!-- FLOATING CONTROLS (Calibration) -->
                <div class="digi-panel top-left">
                    <h4 class="cal-header-title">1. –ë–∞–∑–æ–≤—ã–µ —Ç–æ—á–∫–∏ (Start)</h4>
                    <p class="cal-instr">
                        –°–æ–≤–º–µ—Å—Ç–∏—Ç–µ –ø–µ—Ä–µ–∫—Ä–µ—Å—Ç–∏–µ —Å –Ω–∞—á–∞–ª–æ–º –æ—Å–µ–π –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–µ –∏ –∑–∞—Ñ–∏–∫—Å–∏—Ä—É–π—Ç–µ X0 –∏ Y0 –æ—Ç–¥–µ–ª—å–Ω–æ.
                    </p>

                    <div class="cal-group">
                        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:10px;">
                            <div>
                                <label>–ó–Ω–∞—á–µ–Ω–∏–µ X0</label>
                                <input type="number" id="valX0" value="0" class="mini-input">
                                <button class="btn btn-primary btn-sm" id="btnFixX0">
                                    üéØ SET X0
                                </button>
                            </div>
                            <div>
                                <label>–ó–Ω–∞—á–µ–Ω–∏–µ Y0</label>
                                <input type="number" id="valY0" value="0" class="mini-input">
                                <button class="btn btn-primary btn-sm" id="btnFixY0">
                                    üéØ SET Y0
                                </button>
                            </div>
                        </div>
                    </div>

                    <h4 class="cal-header-title">2. –ú–∞—Å—à—Ç–∞–±–Ω—ã–µ —Ç–æ—á–∫–∏ (Scale)</h4>
                    <p class="cal-instr">
                        –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏ –Ω–∞ –∫—Ä–∞–π–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –æ—Å–µ–π –∏ –∑–∞—Ñ–∏–∫—Å–∏—Ä—É–π—Ç–µ –∏—Ö.
                    </p>

                    <div class="cal-group">
                        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:10px;">
                            <div>
                                <label>–ó–Ω–∞—á–µ–Ω–∏–µ X1</label>
                                <input type="number" id="valX1" value="100" class="mini-input">
                                <button class="btn btn-primary btn-sm" id="btnFixX1" disabled>
                                    ‚úÖ FIX X1
                                </button>
                            </div>
                            <div>
                                <label>–ó–Ω–∞—á–µ–Ω–∏–µ Y1</label>
                                <input type="number" id="valY1" value="50" class="mini-input">
                                <button class="btn btn-primary btn-sm" id="btnFixY1" disabled>
                                    ‚úÖ FIX Y1
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- ACTION -->
                    <div
                        style="margin-top:15px; border-top:1px solid #eee; padding-top:10px; display:flex; flex-direction:column; gap:10px;">
                        <button class="btn btn-danger" id="btnAddPoint" style="width:100%; font-weight:700;" disabled>
                            üéØ –°–ù–Ø–¢–¨ –¢–û–ß–ö–£ (SPACE)
                        </button>
                        <button class="btn btn-primary" id="btnBuildCurve" onclick="DigiCore.buildCurves()"
                            style="width:100%;" disabled>
                            –ü–û–°–¢–†–û–ò–¢–¨ –ì–†–ê–§–ò–ö
                        </button>
                        <button class="btn btn-success" onclick="DigiCore.exportData()"
                            style="width:100%; font-weight:700;">
                            –≠–ö–°–ü–û–†–¢–ò–†–û–í–ê–¢–¨
                        </button>
                        <button class="btn btn-outline" onclick="DigiCore.resetAll()" style="width:100%;">
                            üîÑ –°–ë–†–û–°–ò–¢–¨ –ö–ê–õ–ò–ë–†–û–í–ö–£
                        </button>
                    </div>
                </div>

                <!-- POINTS LIST (Right) -->
                <div class="digi-panel top-right">
                    <h4 style="margin:0 0 5px 0;">–¢–æ—á–∫–∏ (<span id="lblPointCount">0</span>)</h4>
                    <div id="digiPointsList" class="points-list"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODALS -->
    <div id="saveModal" class="modal-overlay">
        <div class="modal-box">
            <h3 id="modalTitle" style="margin-top:0;">–ó–∞–ø–∏—Å—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç</h3>
            <p style="color:#666; margin-bottom:20px;">–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:</p>
            <div style="display:flex; flex-direction:column; gap:10px;">
                <button class="btn btn-success" onclick="resolveModal('update')">–û–ë–ù–û–í–ò–¢–¨ –¢–ï–ö–£–©–£–Æ</button>
                <button class="btn btn-primary" onclick="resolveModal('new')">–°–û–ó–î–ê–¢–¨ –ù–û–í–£–Æ</button>
                <button class="btn btn-secondary" onclick="resolveModal('cancel')">–û–¢–ú–ï–ù–ê</button>
            </div>
        </div>
    </div>

    <div id="importModal" class="modal-overlay">
        <div class="modal-box">
            <h3 style="margin-top:0;">–ò–º–ø–æ—Ä—Ç –ë–∞–∑—ã –î–∞–Ω–Ω—ã—Ö</h3>
            <p style="color:#666;">–í–Ω–∏–º–∞–Ω–∏–µ! –ò–º–ø–æ—Ä—Ç –º–æ–∂–µ—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å –¥–∞–Ω–Ω—ã–µ.</p>
            <div style="display:flex; flex-direction:column; gap:10px;">
                <button class="btn btn-primary" onclick="finalizeImport(true)">MERGE (–û–±—ä–µ–¥–∏–Ω–∏—Ç—å)</button>
                <button class="btn btn-danger" style="background:var(--brand-danger); color:white"
                    onclick="finalizeImport(false)">OVERWRITE (–ó–∞–º–µ–Ω–∏—Ç—å –≤—Å—ë)</button>
                <button class="btn btn-secondary" onclick="closeImportModal()">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <div id="exportLoader" class="modal-overlay" style="z-index: 2000; background: rgba(255,255,255,0.9);">
        <div style="text-align:center;">
            <div class="spinner"></div>
            <p style="margin-top:20px; font-weight:700; color:var(--brand-primary);">–ì–ï–ù–ï–†–ê–¶–ò–Ø –û–¢–ß–ï–¢–ê (PDF)...</p>
            <p style="color:#666; font-size:14px;">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ, —ç—Ç–æ –∑–∞–π–º–µ—Ç –ø–∞—Ä—É —Å–µ–∫—É–Ω–¥</p>
        </div>
    </div>

    <!-- AUTH MODAL -->
    <div id="authModal" class="modal-overlay">
        <div class="modal-box" style="max-width:400px;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h3 id="authModalTitle" style="margin:0;">–í—Ö–æ–¥ –≤ –ö–æ–º–∞–Ω–¥—É</h3>
                <button class="btn-close" onclick="closeAuthModal()">√ó</button>
            </div>

            <div id="loginForm">
                <input type="email" id="loginEmail" class="form-input" placeholder="Email" style="margin-bottom:10px;">
                <input type="password" id="loginPass" class="form-input" placeholder="–ü–∞—Ä–æ–ª—å"
                    style="margin-bottom:20px;">
                <button class="btn btn-primary" onclick="handleLogin()"
                    style="width:100%; margin-bottom:15px;">–í–û–ô–¢–ò</button>
                <p style="text-align:center; font-size:13px; color:#666;">
                    –ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a href="javascript:void(0)" onclick="showRegister()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é</a>
                </p>
            </div>

            <div id="registerForm" style="display:none;">
                <input type="text" id="regOrg" class="form-input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏"
                    style="margin-bottom:10px;">
                <input type="email" id="regEmail" class="form-input" placeholder="Email –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞"
                    style="margin-bottom:10px;">
                <input type="password" id="regPass" class="form-input" placeholder="–ü–∞—Ä–æ–ª—å" style="margin-bottom:20px;">
                <button class="btn btn-success" onclick="handleRegister()"
                    style="width:100%; margin-bottom:15px;">–°–û–ó–î–ê–¢–¨</button>
                <p style="text-align:center; font-size:13px; color:#666;">
                    –£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <a href="javascript:void(0)" onclick="showLogin()">–í–æ–π—Ç–∏</a>
                </p>
            </div>
        </div>
    </div>

    <!-- ADMIN VIEW -->
    <div id="tab-admin" class="workspace-view" style="display:none; flex-direction:column; padding:20px;">
        <div class="archive-wrapper" style="max-width:800px; margin:0 auto; width:100%;">
            <h3 style="margin-top:0;">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–µ–π</h3>
            <div class="control-group" style="margin-bottom:30px;">
                <legend>–î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</legend>
                <div style="display:flex; gap:10px;">
                    <input type="email" id="newUserEmail" class="form-input" placeholder="Email">
                    <input type="password" id="newUserPass" class="form-input" placeholder="–ü–∞—Ä–æ–ª—å">
                    <button class="btn btn-success" onclick="addUser()" style="width:auto;">–î–æ–±–∞–≤–∏—Ç—å</button>
                </div>
            </div>
            <table class="archive-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Email</th>
                        <th>–†–æ–ª—å</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody id="userListBody"></tbody>
            </table>
        </div>
    </div>

    <script>const API_URL = "";</script>
    <!-- Vite Entry Point -->
    <script type="module" src="/src/main.js"></script>
</body>

</html>